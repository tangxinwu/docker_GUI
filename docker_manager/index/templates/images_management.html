<!doctype html>
<html lang="en">
<head>
	<meta charset="utf-8" />
	<link rel="icon" type="image/png" href="/static/assets/img/favicon.ico">
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />

	<title>Docker 镜像管理界面</title>

	<meta content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0' name='viewport' />
    <meta name="viewport" content="width=device-width" />





    <!-- Bootstrap core CSS     -->
    <link href="/static/css/bootstrap.min.css" rel="stylesheet" />

    <!--  Light Bootstrap Dashboard core CSS    -->
    <link href="/static/css/light-bootstrap-dashboard.css" rel="stylesheet"/>

    <!--  CSS for Demo Purpose, don't include it in your project     -->
    <link href="/static/css/demo.css" rel="stylesheet" />


    <!--     Fonts and icons     -->
    <link href="/static/css/font-awesome.min.css" rel="stylesheet">
    <link href='/static/css/685fd913f1e14aebad0cc9d3713ee469.css' rel='stylesheet' type='text/css'>
    <link href="/static/css/pe-icon-7-stroke.css" rel="stylesheet" />

</head>
<body class="sidebar-mini">

<div class="wrapper">
    <div class="sidebar" data-color="black" data-image="/static/assets/img/full-screen-image-3.jpg">
        <!--

            Tip 1: you can change the color of the sidebar using: data-color="blue | azure | green | orange | red | purple"
            Tip 2: you can also add an image using data-image tag

        -->

        <div class="logo">
            <a href=""#" class="logo-text">
                DOCKER 管理
            </a>
        </div>
		<div class="logo logo-mini">
			<a href=""#" class="logo-text">
				DM
			</a>
		</div>

    	<div class="sidebar-wrapper">

            <div class="user">
                <div class="photo">
                    <img src="/static/picture/default-avatar.png" />
                </div>
                <div class="info">
                    <a data-toggle="collapse" href="#collapseExample" class="collapsed">
                        唐鑫吾
                        <b class="caret"></b>
                    </a>
                    <div class="collapse" id="collapseExample">
                        <ul class="nav">
                            <li><a href="#">My Profile</a></li>
                            <li><a href="#">Edit Profile</a></li>
                            <li><a href="#">Settings</a></li>
                        </ul>
                    </div>
                </div>
            </div>

            <ul class="nav">
                <li>
                    <a href="/index/">
                        <i class="pe-7s-graph"></i>
                        <p>容器列表</p>
                    </a>
                </li>
                <li class="active">
                    <a  href="/images_management/">
                        <i class="pe-7s-plugin"></i>
                        <p>镜像管理
                        </p>
                    </a>
                </li>
                <li>
                    <a  href="/local_registry/">
                        <i class="pe-7s-server"></i>
                        <p>本地仓库
                        </p>
                    </a>
                </li>
{#                <li>#}
{#                    <a data-toggle="collapse" href="#formsExamples">#}
{#                        <i class="pe-7s-note2"></i>#}
{#                        <p>Forms#}
{#                           <b class="caret"></b>#}
{#                        </p>#}
{#                    </a>#}
{#                    <div class="collapse" id="formsExamples">#}
{#                        <ul class="nav">#}
{#                            <li><a href="/static/forms/regular.html">Regular Forms</a></li>#}
{#                            <li><a href="/static/forms/extended.html">Extended Forms</a></li>#}
{#                            <li><a href="/static/forms/validation.html">Validation Forms</a></li>#}
{#                            <li><a href="/static/forms/wizard.html">Wizard</a></li>#}
{#                        </ul>#}
{#                    </div>#}
{#                </li>#}
{##}
{##}
{#                <li>#}
{#                    <a data-toggle="collapse" href="#mapsExamples">#}
{#                        <i class="pe-7s-map-marker"></i>#}
{#                        <p>Maps#}
{#                           <b class="caret"></b>#}
{#                        </p>#}
{#                    </a>#}
{#                    <div class="collapse" id="mapsExamples">#}
{#                        <ul class="nav">#}
{#                            <li><a href="/static/maps/google.html">Google Maps</a></li>#}
{#                            <li><a href="/static/maps/vector.html">Vector Maps</a></li>#}
{#                            <li><a href="/static/maps/fullscreen.html">Full Screen Map</a></li>#}
{#                        </ul>#}
{#                    </div>#}
{#                </li>#}
{##}
{#                <li>#}
{#                    <a href="/static/charts.html">#}
{#                        <i class="pe-7s-graph1"></i>#}
{#                        <p>Charts</p>#}
{#                    </a>#}
{#                </li>#}
{##}
{#                <li>#}
{#                    <a href="/static/calendar.html">#}
{#                        <i class="pe-7s-date"></i>#}
{#                        <p>Calendar</p>#}
{#                    </a>#}
{#                </li>#}
{##}
{#                <li>#}
{#                    <a data-toggle="collapse" href="#pagesExamples">#}
{#                        <i class="pe-7s-gift"></i>#}
{#                        <p>Pages#}
{#                           <b class="caret"></b>#}
{#                        </p>#}
{#                    </a>#}
{#                    <div class="collapse" id="pagesExamples">#}
{#                        <ul class="nav">#}
{#                            <li><a href="/static/pages/login.html">Login Page</a></li>#}
{#                            <li><a href="/static/pages/register.html">Register Page</a></li>#}
{#                            <li><a href="/static/pages/lock.html">Lock Screen Page</a></li>#}
{#                            <li><a href="/static/pages/user.html">User Page</a></li>#}
{#                            <li><a href="#">More coming soon/static.</a></li>#}
{#                        </ul>#}
{#                    </div>#}
{#                </li>#}
            </ul>
    	</div>
    </div>

    <div class="main-panel">
        <nav class="navbar navbar-default">
            <div class="container-fluid">
				<div class="navbar-minimize">
					<button id="minimizeSidebar" class="btn btn-warning btn-fill btn-round btn-icon">
						<i class="fa fa-ellipsis-v visible-on-sidebar-regular"></i>
						<i class="fa fa-navicon visible-on-sidebar-mini"></i>
					</button>
				</div>
                <div class="navbar-header">
                    <button type="button" class="navbar-toggle" data-toggle="collapse">
                        <span class="sr-only">Toggle navigation</span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                    <a class="navbar-brand" href="#">DOCKER 镜像列表</a>
                </div>
                <div class="collapse navbar-collapse">



                    <ul class="nav navbar-nav navbar-right">
                        <li>
                            <a href="/static/charts.html">
                                <i class="fa fa-line-chart"></i>
                                <p>Stats</p>
                            </a>
                        </li>

                        <li class="dropdown">
                            <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                                <i class="fa fa-gavel"></i>
                                <p class="hidden-md hidden-lg">
                                    Actions
                                    <b class="caret"></b>
                                </p>
                            </a>
                            <ul class="dropdown-menu">
                                <li><a id="CreateNewImage" href="#" onclick="NewImages_pop();">获取新镜像</a></li>
                                <li><a href="#">Manage Something</a></li>
                                <li><a href="#">Do Nothing</a></li>
                                <li><a href="#">Submit to live</a></li>
                                <li class="divider"></li>
                                <li><a href="#">Another Action</a></li>
                            </ul>
                        </li>

                        <li class="dropdown">
                            <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                                <i class="fa fa-bell-o"></i>
                                {% if  notifications_len %}
                                <span class="notification">{{ notifications_len }}</span>
                                {% endif %}
                                <p class="hidden-md hidden-lg">
    								Notifications
    								<b class="caret"></b>
    							</p>
                            </a>
                            <ul class="dropdown-menu" id="download_log">
                                {% for notification in notifications %}
                                    {% ifequal notification.PullStatus 2 %}
                                        <li><a href="#">{{ notification.ImageName }} 下载失败</a></li>
                                    {% endifequal %}
                                    {% ifequal notification.PullStatus 0 %}
                                        <li><a href="#">{{ notification.ImageName }} 正在下载</a></li>
                                    {% endifequal %}
                                {% endfor %}
                            </ul>
                        </li>

                        <li class="dropdown dropdown-with-icons">
                            <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                                <i class="fa fa-list"></i>
                                <p class="hidden-md hidden-lg">
    								More
    								<b class="caret"></b>
    							</p>
                            </a>
                            <ul class="dropdown-menu dropdown-with-icons">
                                <li>
                                    <a href="#">
                                        <i class="pe-7s-mail"></i> Messages
                                    </a>
                                </li>
                                <li>
                                    <a href="#">
                                        <i class="pe-7s-help1"></i> Help Center
                                    </a>
                                </li>
                                <li>
                                    <a href="#">
                                        <i class="pe-7s-tools"></i> Settings
                                    </a>
                                </li>
                                <li class="divider"></li>
                                <li>
                                    <a href="#">
                                        <i class="pe-7s-lock"></i> Lock Screen
                                    </a>
                                </li>
                                <li>
                                    <a href="#" class="text-danger">
                                        <i class="pe-7s-close-circle"></i>
                                        Log out
                                    </a>
                                </li>
                            </ul>
                        </li>

                    </ul>
                </div>
            </div>
        </nav>



        <div class="content">
            <div class="container-fluid">

                <div class="row">
                    <div class="col-md-12">
                        <div class="card">
                            <div class="content">
								<div class="toolbar">
	                                <!--        Here you can write extra buttons/actions for the toolbar              -->
	                            </div>
                                <div class="fresh-datatables">
                					<table id="datatables" class="table table-striped table-no-bordered table-hover" cellspacing="0" width="100%" style="width:100%">
                						<thead>
                							<tr>
                								<th>镜像tag名</th>
                								<th>镜像ID</th>
                								<th>镜像大小(字节)</th>

                								<th class="disabled-sorting text-right">操作</th>
                							</tr>
                						</thead>
                						<tbody>
                                        {% for image in images %}
                							<tr>
                                                {% csrf_token %}
                                                {% load rewrite_display %}
                								<td>{{ image.tags|rewrite_display:"" }}</td>
                								<td>{{ image.short_id }}</td>
                                                {% load rewrite_attr %}
                								<td>{{ image.attrs|rewrite_attr:"VirtualSize" }}</td>

                								<td class="text-right">
                									<a href="#" class="btn btn-simple btn-info btn-icon like"><i class="pe-7s-plus"></i></a>
                                                    <a href="#" class="btn btn-simple btn-danger btn-icon stop"><i class="pe-7s-power"></i></a>
                									<a href="#" class="btn btn-simple btn-warning btn-icon edit"><i class="pe-7s-refresh-2"></i></a>
                									<a href="#" class="btn btn-simple btn-danger btn-icon remove"><i class="pe-7s-trash"></i></a>
                                                    <a href="#" class="btn btn-simple btn btn-icon view"><i class="pe-7s-note2"></i></a>
                								</td>
                							</tr>
                                        {% endfor %}

                					</table>
        				        </div>
                            </div><!-- end content-->
                        </div><!--  end card  -->
                    </div> <!-- end col-md-12 -->
                </div> <!-- end row -->

            </div>
        </div>
    <!----获取新镜像弹出层开始---->
        <div id="popmodal" class="modal container fade" tabindex="-1" style="display: none;">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                <h4 class="modal-title" style="color: #FFFFFF;text-align: center;" ></h4>
            </div>
            <div class="modal-body">
                <div style="width: 33%">
                <p>
                    <input class="form-control" type="text"  id='repository' name='repository' required="required" aria-required="true" style="width: 50%;margin-left: 125%;" placeholder="输入新的镜像名字">
                    <br>
                    <input class="form-control" type="text"  id='tag' name='tag' required="required" aria-required="true" style="width: 50%;margin-left: 125%;" placeholder="输入新的镜像标签">
                    <br>
                    {% csrf_token %}
                    <input class="btn btn-info" type="button" value="PULL" style="margin-left: 140%" onclick="Pull_images();">
                </p>
                </div>

            </div>
            <div class="modal-footer" style="text-align: center;">
                <button type="button" data-dismiss="modal" class="btn btn-default">关闭</button>
            </div>
        </div>

    <!----获取新镜像弹出层结束---->

    <!----创建容器弹出层开始---->
        <div id="created_modal" class="modal container fade" tabindex="-1" style="display: none;">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                <h4 class="modal-title" style="color: #FFFFFF;text-align: center;" ></h4>
            </div>
            <div class="modal-body" style="height: 388px;">
                <div class="col-md-12">
                    <div class="card">
                        <div class="header">
                            <legend>新建容器</legend>
                        </div>
                        <div class="content">
                            <form method="get" action="/" class="form-horizontal">
                                    <fieldset>
                                        <div class="form-group">
                                            <label class="col-sm-2 control-label">使用的镜像名</label>
                                            <div class="col-sm-10">
                                                <input type="text" placeholder="Disabled input here..." disabled="" class="form-control" id="image">
                                            </div>
                                        </div>
                                    </fieldset>

                                    <fieldset>
                                        <div class="form-group">
                                            <label class="col-sm-2 control-label">使用的命令</label>
                                            <div class="col-sm-10">
                                                <input type="text" class="form-control" id="command">

                                            </div>
                                        </div>
                                    </fieldset>

                                    <fieldset>
                                        <div class="form-group">
                                            <label class="col-sm-2 control-label">容器的名字(唯一)</label>
                                            <div class="col-sm-10">
                                                <input type="text" class="form-control" id="name">

                                            </div>
                                        </div>
                                    </fieldset>

                                    <fieldset>
                                        <div class="form-group">
                                            <label class="col-sm-2 control-label">映射端口</label>
                                            <div class="col-sm-10">
                                                <input type="text" class="form-control" id="port" placeholder="容器内端口">
                                                <input type="text" class="form-control" id="port" placeholder="容器内端口">
                                            </div>
                                        </div>
                                    </fieldset>

                                    <fieldset>
                                        <div class="form-group">
                                            <label class="col-sm-2 control-label">运行选项</label>
                                            <div class="col-sm-10">
                                                <label class="checkbox">
                                                    <span class="icons"><span class="first-icon fa fa-square-o"></span><span class="second-icon fa fa-check-square-o"></span></span><input type="checkbox"  value="" id="init">运行init
                                                </label>
                                                <label class="checkbox">
                                                    <span class="icons"><span class="first-icon fa fa-square-o"></span><span class="second-icon fa fa-check-square-o"></span></span><input type="checkbox"  value="" id="tty">运行tty终端
                                                </label>
                                                <label class="checkbox">
                                                    <span class="icons"><span class="first-icon fa fa-square-o"></span><span class="second-icon fa fa-check-square-o"></span></span><input type="checkbox"  value="" id="detach">后端运行
                                                </label>
                                            </div>
                                        </div>
                                    </fieldset>
                                </form>
                        </div>


                    </div>
                </div>

            </div>
            <div class="modal-footer" style="text-align: center;">
                <button class="btn btn-info btn-fill btn-wd" onclick="create_container();">创建容器</button>
                <button type="button" data-dismiss="modal" class="btn btn-info btn-fill btn-wd">关闭</button>
            </div>
        </div>

    <!----创建容器弹出层结束---->

    <!----显示镜像详细信息弹出层开始---->
        <div id="detail_modal" class="modal container fade" tabindex="-1" style="display: none;">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                <h4 class="modal-title" style="color: #FFFFFF;text-align: center;" ></h4>
            </div>
            <div class="modal-body" style="height: 388px;">
                <div class="col-md-12">
                    <div class="card">
                        <div class="header">
                            <legend>新建容器</legend>
                        </div>
                        <div class="content">
                            <form method="get" action="/" class="form-horizontal">
                                    <fieldset>
                                        <div class="form-group">
                                            <label class="col-sm-2 control-label">镜像详细说明</label>
                                            <div class="col-sm-10">
                                                <p id="image_detail"></p>
                                            </div>
                                        </div>
                                    </fieldset>
                                </form>
                        </div>


                    </div>
                </div>

            </div>
            <div class="modal-footer" style="text-align: center;">
                <button type="button" data-dismiss="modal" class="btn btn-info btn-fill btn-wd">关闭</button>
            </div>
        </div>

    <!----显示镜像详细内容弹出层结束---->



        <footer class="footer">
            <div class="container-fluid">
                <nav class="pull-left">
                    <ul>
                        <li>
                            <a href="#">
                                Home
                            </a>
                        </li>
                        <li>
                            <a href="#">
                                Company
                            </a>
                        </li>
                        <li>
                            <a href="#">
                                Portfolio
                            </a>
                        </li>
                        <li>
                            <a href="#">
                               Blog
                            </a>
                        </li>
                    </ul>
                </nav>
                <p class="copyright pull-right">
                    &copy; 2016 <a href=""#">Creative Tim</a>, made with love for a better web
                </p>
            </div>
        </footer>


    </div>
</div>


</body>

    <!--   Core JS Files and PerfectScrollbar library inside jquery.ui   -->
    <script src="/static/js/jquery.min.js" type="text/javascript"></script>
    <script src="/static/js/jquery-ui.min.js" type="text/javascript"></script>
	<script src="/static/js/bootstrap.min.js" type="text/javascript"></script>


	<!--  Forms Validations Plugin -->
	<script src="/static/js/jquery.validate.min.js"></script>

	<!--  Plugin for Date Time Picker and Full Calendar Plugin-->
	<script src="/static/js/moment.min.js"></script>

    <!--  Date Time Picker Plugin is included in this js file -->
    <script src="/static/js/bootstrap-datetimepicker.js"></script>

    <!--  Select Picker Plugin -->
    <script src="/static/js/bootstrap-selectpicker.js"></script>

	<!--  Checkbox, Radio, Switch and Tags Input Plugins -->
	<script src="/static/js/bootstrap-checkbox-radio-switch-tags.js"></script>

	<!--  Charts Plugin -->
	<script src="/static/js/chartist.min.js"></script>

    <!--  Notifications Plugin    -->
    <script src="/static/js/bootstrap-notify.js"></script>

    <!-- Sweet Alert 2 plugin -->
	<script src="/static/js/sweetalert2.js"></script>

    <!-- Vector Map plugin -->
	<script src="/static/js/jquery-jvectormap.js"></script>


	<!-- Wizard Plugin    -->
    <script src="/static/js/jquery.bootstrap.wizard.min.js"></script>

	<!--  Bootstrap Table Plugin    -->
	<script src="/static/js/bootstrap-table.js"></script>

	<!--  Plugin for DataTables.net  -->
	<script src="/static/js/jquery.datatables.js"></script>

    <!--  Full Calendar Plugin    -->
    <script src="/static/js/fullcalendar.min.js"></script>

    <!-- Light Bootstrap Dashboard Core javascript and methods -->
	<script src="/static/js/light-bootstrap-dashboard.js"></script>

	<!--   Sharrre Library    -->
    <script src="/static/js/jquery.sharrre.js"></script>

	<!-- Light Bootstrap Dashboard DEMO methods, don't include it in your project! -->
	<script src="/static/js/demo.js"></script>

    <!-- 主要功能JS -->
    <script src="/static/js/main_functions.js"></script>

    <script type="text/javascript">
    $(document).ready(function() {
		$('#datatables').DataTable({
		    "pagingType": "full_numbers",
		    "lengthMenu": [[10, 25, 50, -1], [10, 25, 50, "All"]],
		    responsive: true,
		    language: {
		    search: "_INPUT_",
		    searchPlaceholder: "Search records",
		    }

		});


		var table = $('#datatables').DataTable();

		// restart record
		table.on( 'click', '.edit', function () {
		     $tr = $(this).closest('tr');
		     var data = table.row($tr).data();
             $.post('/index/',{'action':'restart','container_name':data[0]},function (result) {
                 alert(data[0] + " " + result);
                 setTimeout("window.location.reload()", 1000);

             });
		} );

		// Delete image
		table.on( 'click', '.remove', function (e) {
		    $tr = $(this).closest('tr');
{#		    table.row($tr).remove().draw();#}
		    var data = table.row($tr).data();
		    $.post("/delete_image/", {"image_name" : data[0]},function (result) {
                alert(result);
                setTimeout("window.location.reload()", 1000);
            });
		} );

		//新建contrainer
		table.on( 'click', '.like', function () {
		     $tr = $(this).closest('tr');
		     var data = table.row($tr).data();
		     $('#image').val(data[0].replace('\'','').replace('\'',''));
             $('#created_modal').modal();
             }
		);

		//Stop record
		table.on( 'click', '.stop', function () {
		     $tr = $(this).closest('tr');
		     var data = table.row($tr).data();
		     if (data[3]=="exited"){
		         alert(data[0] + "未被启动！");
             }else {
		         $.post('/index/',{'action':'stop','container_name':data[0]},function (result) {
                     alert(data[0] + " " + result);
                     setTimeout("window.location.reload()", 1000);
                 });

             }
		});

		//view record
		table.on( 'click', '.view', function (e) {
		    $tr = $(this).closest('tr');
		    var data = table.row($tr).data();
		    $('#image_detail').empty();
		    $("#detail_modal").modal();
		    $.post("/image_detail/", {"image_name" : data[0]},function (result) {
               $('#image_detail').append(result);
            });
		} );

        //
{#        var logs_objects = $("#download_log a");#}
{#        //alert(logs_objects.length);#}
{#        logs_objects.each(function (k, v) {#}
{#            var image_name = v.innerHTML.match('^[a-zA-Z].*[0-9a-zA-Z]');#}
{#           //alert(image_name);#}
{#            var tt = JSON.stringify({'name': image_name});#}
{#            $.post('/status_check/', tt, function (result) {#}
{#            //        alert(result);#}
{#            });#}
{#        });#}


	});

    </script>



</html>
